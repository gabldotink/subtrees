--- origsrc/libspf2/Makefile.am	2021-10-30 21:43:32.000000000 +0900
+++ src/libspf2/Makefile.am	2021-10-30 21:56:30.291407800 +0900
@@ -11,3 +11,6 @@ dist-hook:
 	@if [ -f perl/Makefile ] ; then \
 		make -C perl clean ; \
 	fi
+
+pkgconfigdir = $(libdir)/pkgconfig
+pkgconfig_DATA = $(PACKAGE).pc
--- origsrc/libspf2/configure.ac	2021-10-30 21:43:32.000000000 +0900
+++ src/libspf2/configure.ac	2021-10-30 21:56:30.227377100 +0900
@@ -20,6 +20,7 @@ AC_SUBST([KV_MAJOR])
 AC_SUBST([KV_MINOR])
 AC_SUBST([KV_PATCH])
 
+mkdir -p src/include
 cat >$srcdir/src/include/spf_lib_version.h <<_EOF_VERSION
 /**
  * @file
@@ -215,7 +216,7 @@ AC_CHECK_DECLS([res_ninit], [], [], [[
 	# include <resolv.h>
 	#endif
 	]])
-AC_CHECK_DECLS([res_ndestroy], [], [], [[
+AC_CHECK_DECLS([res_nclose], [], [], [[
 	#ifdef HAVE_SYS_TYPES_H
 	# include <sys/types.h>
 	#endif
@@ -279,7 +280,7 @@ AC_REPLACE_FUNCS([__ns_initparse __ns_na
 dnl Magnus Holmgren says this avoids linking a private function
 AC_LIBOBJ([__ns_get16])
 
-AC_CONFIG_FILES([Makefile
+AC_CONFIG_FILES([libspf2.pc Makefile
                  Doxyfile
                  src/Makefile
                  src/include/Makefile
--- origsrc/libspf2/libspf2.pc.in	1970-01-01 09:00:00.000000000 +0900
+++ src/libspf2/libspf2.pc.in	2021-10-30 21:57:10.115482100 +0900
@@ -0,0 +1,10 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: libspf2
+Description: Implementation of the Sender Policy Framework for SMTP authorization
+Version: @VERSION@
+Libs: -L${libdir} -lspf2
+Cflags: -I${includedir}/spf2
--- origsrc/libspf2/src/include/spf_lib_version.h	1970-01-01 09:00:00.000000000 +0900
+++ src/libspf2/src/include/spf_lib_version.h	2021-10-30 21:57:51.744657200 +0900
@@ -0,0 +1,12 @@
+/**
+ * @file
+ * @brief Autogenerated configuration information - do not edit.
+ */
+#ifndef INC_SPF_VERSION
+#define INC_SPF_VERSION
+
+#define SPF_LIB_VERSION_MAJOR	1
+#define SPF_LIB_VERSION_MINOR	2
+#define SPF_LIB_VERSION_PATCH	11
+
+#endif
--- origsrc/libspf2/src/libspf2/Makefile.am	2021-10-30 21:43:32.000000000 +0900
+++ src/libspf2/src/libspf2/Makefile.am	2021-10-30 21:47:15.879585300 +0900
@@ -2,7 +2,7 @@
 
 AUTOMAKE_OPTIONS = foreign
 
-AM_CPPFLAGS = -I$(top_srcdir)/src/include -I$(top_srcdir)/src
+AM_CPPFLAGS = -I$(top_builddir)/src/include -I$(top_srcdir)/src/include -I$(top_srcdir)/src
 
 lib_LTLIBRARIES	= libspf2.la
 
@@ -38,7 +38,7 @@ libspf2_la_LIBADD	= $(top_builddir)/src/
 
 
 
-libspf2_la_LDFLAGS	= -version-info 3:0:1
+libspf2_la_LDFLAGS	= -no-undefined -version-info 3:0:1
 
 # Copied from the libtool info file:
 #
--- origsrc/libspf2/src/spf_example/Makefile.am	2021-10-30 21:43:33.000000000 +0900
+++ src/libspf2/src/spf_example/Makefile.am	2021-10-30 21:47:34.876147200 +0900
@@ -5,7 +5,7 @@ AM_CPPFLAGS	= -I$(top_builddir)/src/incl
 
 #LIBS = /usr/lib/libresolv.a
 
-bin_PROGRAMS	= spf_example spf_example_static
+bin_PROGRAMS	= spf_example
 
 spf_example_SOURCES = spf_example.c
 spf_example_LDADD	= $(top_builddir)/src/libspf2/libspf2.la
--- origsrc/libspf2/src/spfd/Makefile.am	2021-10-30 21:43:33.000000000 +0900
+++ src/libspf2/src/spfd/Makefile.am	2021-10-30 21:48:09.708042900 +0900
@@ -1,11 +1,11 @@
 # Makefile prototype
 
 AUTOMAKE_OPTIONS = foreign
-AM_CPPFLAGS	= -I$(top_srcdir)/src/include -I$(top_srcdir)/src
+AM_CPPFLAGS	= -I$(top_builddir)/src/include -I$(top_srcdir)/src/include -I$(top_srcdir)/src
 
 #LIBS = /usr/lib/libresolv.a
 
-bin_PROGRAMS	= spfd spfd_static
+bin_PROGRAMS	= spfd
 
 spfd_SOURCES = spfd.c
 spfd_LDADD	= $(top_builddir)/src/libspf2/libspf2.la
--- origsrc/libspf2/src/spfquery/Makefile.am	2021-10-30 21:43:33.000000000 +0900
+++ src/libspf2/src/spfquery/Makefile.am	2021-10-30 21:48:28.827712700 +0900
@@ -1,11 +1,11 @@
 # Makefile prototype
 
 AUTOMAKE_OPTIONS = foreign
-AM_CPPFLAGS	= -I$(top_srcdir)/src/include -I$(top_srcdir)/src
+AM_CPPFLAGS	= -I$(top_builddir)/src/include -I$(top_srcdir)/src/include -I$(top_srcdir)/src
 
 #LIBS = /usr/lib/libresolv.a
 
-bin_PROGRAMS	= spfquery spfquery_static
+bin_PROGRAMS	= spfquery
 
 spfquery_SOURCES = spfquery.c
 spfquery_LDADD	= $(top_builddir)/src/libspf2/libspf2.la
--- origsrc/libspf2/src/spftest/Makefile.am	2021-10-30 21:43:33.000000000 +0900
+++ src/libspf2/src/spftest/Makefile.am	2021-10-30 21:48:45.393999300 +0900
@@ -1,11 +1,11 @@
 # Makefile prototype
 
 AUTOMAKE_OPTIONS = foreign
-AM_CPPFLAGS	= -I$(top_builddir)/src/include -I$(top_srcdir)/src/include
+AM_CPPFLAGS	= -I$(top_builddir)/src/include -I$(top_builddir)/src/include -I$(top_srcdir)/src/include
 
 #LIBS = /usr/lib/libresolv.a
 
-bin_PROGRAMS	= spftest spftest_static
+bin_PROGRAMS	= spftest
 
 spftest_SOURCES = spftest.c
 spftest_LDADD	= $(top_builddir)/src/libspf2/libspf2.la
