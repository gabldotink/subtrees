--- origsrc/fes/Makefile.am	2020-01-05 00:34:43.000000000 +0900
+++ src/fes/Makefile.am	2020-01-05 01:03:34.989495000 +0900
@@ -3,3 +3,6 @@ ACLOCAL_AMFLAGS = -I m4
 
 EXTRA_DIST = configfsf.guess configfsf.sub 
 SUBDIRS = src test .
+
+pkgconfigdir = $(libdir)/pkgconfig
+pkgconfig_DATA = fes.pc
--- origsrc/fes/configure.ac	2020-01-05 00:34:43.000000000 +0900
+++ src/fes/configure.ac	2020-01-05 01:00:35.280591800 +0900
@@ -102,10 +102,10 @@ AC_TYPE_UINT32_T
 AC_TYPE_UINT64_T
 AC_FUNC_MALLOC
 
-CFLAGS="$CFLAGS $SIMD_CFLAGS -Wall -Wextra -Werror -fPIC $OPT_FLAGS $gcc_cflags_cpu"
+CFLAGS="$CFLAGS $SIMD_CFLAGS -Wall -Wextra -fPIC $OPT_FLAGS $gcc_cflags_cpu"
 
 AC_SUBST(CFLAGS)
 AC_SUBST(LDFLAGS)
 
-AC_CONFIG_FILES([Makefile src/Makefile test/Makefile src/config.h])
+AC_CONFIG_FILES([fes.pc Makefile src/Makefile test/Makefile src/config.h])
 AC_OUTPUT
--- origsrc/fes/fes.pc.in	1970-01-01 09:00:00.000000000 +0900
+++ src/fes/fes.pc.in	2020-01-05 01:00:35.186836400 +0900
@@ -0,0 +1,10 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: fes
+Description: Software library devoted to solving systems of polynomial equations over F2
+Version: @VERSION@
+Libs: -L${libdir} -lfes
+Cflags: -I${includedir}
--- origsrc/fes/src/Makefile.am	2020-01-05 00:34:43.000000000 +0900
+++ src/fes/src/Makefile.am	2020-01-05 00:54:33.864794700 +0900
@@ -3,6 +3,7 @@ AUTOMAKE_OPTIONS = gnu
 libfes_LTLIBRARIES = libfes.la
 libfesdir = $(libdir)
 libfes_la_SOURCES = idx_LUT.c idx_LUT.h common.c wrapper.c fes.h moebius_transform.c
+libfes_la_LDFLAGS = -no-undefined
 include_HEADERS = fes_interface.h
 
 # built_sources.am is generated by... gen_built_sources.py
@@ -12,7 +13,7 @@ BUILT_SOURCES = $(plain_c_sources)
 BUILT_SOURCES += all_functions.h
 
 all_functions.h: gen_built_sources.py
-	$(PYTHON) gen_built_sources.py $@ $(TAB_T) > $@
+	$(PYTHON) $(srcdir)/gen_built_sources.py $@ $(TAB_T) > $@
 
 
 if HAVE_SSE2
@@ -28,7 +29,7 @@ nodist_libfes_la_SOURCES = $(BUILT_SOURC
 CLEANFILES = $(nodist_libfes_la_SOURCES)
 
 autogenerated_c%.c: boilerplate_generator.py
-	$(PYTHON) boilerplate_generator.py $@ > $@
+	$(PYTHON) $(srcdir)/boilerplate_generator.py $@ > $@
 
 autogenerated_asm%.s : gen_qhasm_code.py
-	$(PYTHON) gen_qhasm_code.py $@ > $@
+	$(PYTHON) $(srcdir)/gen_qhasm_code.py $@ > $@
--- origsrc/fes/src/fes.h	2020-01-05 00:34:43.000000000 +0900
+++ src/fes/src/fes.h	2020-01-05 00:50:14.381224600 +0900
@@ -56,6 +56,7 @@ void free_system(int n, int n_eqs, syste
 #include "all_functions.h"
 void moebius_transform(int n, pck_vector_t F[], solution_callback_t callback, void* callback_state); // moebius_transform.c
 
+#include <emmintrin.h>
 void print_vec(__m128i foo);
 
 
--- origsrc/fes/test/Makefile.am	2020-01-05 00:34:43.000000000 +0900
+++ src/fes/test/Makefile.am	2020-01-05 00:56:46.191343900 +0900
@@ -1,4 +1,4 @@
-AM_CPPFLAGS = -I$(top_srcdir)/src
+AM_CPPFLAGS = -I$(top_builddir)/src -I$(top_srcdir)/src
 LDADD = $(top_builddir)/src/libfes.la rand.o
 
 TESTS = test_suite.py
